rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Coops Collection
    // Read: All authenticated users (e.g. app users)
    // Write: Only the specific ESP32 device ID (simulated)
    match /coops/{document=**} {
      allow read: if isAuthenticated();
      allow write: if request.auth.uid == 'ESP32_DEVICE_01';
    }

    // Telemetry History
    // Read: Authenticated users
    // Write: DENIED for clients. Only Cloud Functions (Admin SDK) can write here.
    match /telemetry_history/{document=**} {
      allow read: if isAuthenticated();
      allow write: if false; 
    }

    // Daily Stats
    // Read: Authenticated users
    // Write: DENIED for clients. Only Cloud Functions.
    match /daily_stats/{document=**} {
      allow read: if isAuthenticated();
      allow write: if false;
    }
  }
}
